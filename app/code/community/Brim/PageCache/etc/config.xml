<?xml version="1.0"?>
<!--
/**
 * Brim LLC Commercial Extension
 *
 * NOTICE OF LICENSE
 *
 * This source file is subject to the Brim LLC Commercial Extension License
 * that is bundled with this package in the file Brim-LLC-Magento-License.pdf.
 * It is also available through the world-wide-web at this URL:
 * http://ecommerce.brimllc.com/license
 * If you did not receive a copy of the license and are unable to
 * obtain it through the world-wide-web, please send an email
 * to support@brimllc.com so we can send you a copy immediately.
 *
 * @category   Brim
 * @package    Brim_PageCache
 * @copyright  Copyright (c) 2011-2012 Brim LLC
 * @license    http://ecommerce.brimllc.com/license
 */
-->
<config>
	<modules>
		<Brim_PageCache>
			<version>2.1.3</version>
		</Brim_PageCache>
	</modules>
	<global>
		<models>
			<brim_pagecache>
				<class>Brim_PageCache_Model</class>
			</brim_pagecache>
		</models>
        <resources>
            <brim_pagecache_setup>
                <setup>
                    <module>Brim_PageCache</module>
                </setup>
            </brim_pagecache_setup>
        </resources>
		<blocks>
			<brim_pagecache>
				<class>Brim_PageCache_Block</class>
			</brim_pagecache>
		</blocks>
		<helpers>
			<brim_pagecache>
				<class>Brim_PageCache_Helper</class>
			</brim_pagecache>
		</helpers>
        <cache>
            <types>
                <brim_pagecache>
                    <label>Full Page Cache</label>
                    <description>Full Page Cache</description>
                    <tags>BRIM_FPC</tags>
                </brim_pagecache>
            </types>
            <expires>
                <brim_pagecache>
                    <label>Full Page Cache</label>
                </brim_pagecache>
            </expires>
        </cache>
		<events>
            <controller_action_postdispatch_adminhtml_cache_flushSystem>
				<observers>
					<brim_pagecache>
						<type>singleton</type>
						<class>brim_pagecache/adminhtml_observer</class>
						<method>cleanPageCache</method>
					</brim_pagecache>
				</observers>
            </controller_action_postdispatch_adminhtml_cache_flushSystem>
            <!-- Causes excessive messages and/or flushing -->
            <!--
            <controller_action_postdispatch_adminhtml_system_config_save>
                <observers>
                    <brim_pagecache>
                        <type>singleton</type>
                        <class>brim_pagecache/adminhtml_observer</class>
                        <method>invalidateCache</method>
                    </brim_pagecache>
                </observers>
            </controller_action_postdispatch_adminhtml_system_config_save>
            -->
            <controller_action_postdispatch_adminhtml_catalog_product_action_attribute_save>
                <observers>
                    <brim_pagecache>
                        <type>singleton</type>
                        <class>brim_pagecache/adminhtml_observer</class>
                        <method>invalidateCache</method>
                    </brim_pagecache>
                </observers>
            </controller_action_postdispatch_adminhtml_catalog_product_action_attribute_save>
            <controller_action_postdispatch_adminhtml_catalog_product_massStatus>
                <observers>
                    <brim_pagecache>
                        <type>singleton</type>
                        <class>brim_pagecache/adminhtml_observer</class>
                        <method>invalidateCache</method>
                    </brim_pagecache>
                </observers>
            </controller_action_postdispatch_adminhtml_catalog_product_massStatus>
            <catalog_product_save_after>
                <observers>
                    <brim_pagecache>
                        <type>singleton</type>
                        <class>brim_pagecache/observer</class>
                        <method>cleanProductCache</method>
                    </brim_pagecache>
                </observers>
            </catalog_product_save_after>
            <catalog_category_save_after>
                <observers>
                    <brim_pagecache>
                        <type>singleton</type>
                        <class>brim_pagecache/observer</class>
                        <method>cleanCategoryCache</method>
                    </brim_pagecache>
                </observers>
            </catalog_category_save_after>
            <cms_page_save_after>
                <observers>
                    <brim_pagecache>
                        <type>singleton</type>
                        <class>brim_pagecache/observer</class>
                        <method>cleanCMSPageCache</method>
                    </brim_pagecache>
                </observers>
            </cms_page_save_after>
            <!-- cataloginventory_stock_item_save_after is more accurate for now -->
            <!--
            <sales_model_service_quote_submit_success>
                <observers>
                    <brim_pagecache>
                        <type>singleton</type>
                        <class>brim_pagecache/observer</class>
                        <method>cleanProductCacheAfterOrder</method>
                    </brim_pagecache>
                </observers>
            </sales_model_service_quote_submit_success>
            -->
            <cataloginventory_stock_item_save_after>
                <observers>
                    <brim_pagecache>
                        <type>singleton</type>
                        <class>brim_pagecache/observer</class>
                        <method>cleanProductCacheOnStockChange</method>
                    </brim_pagecache>
                </observers>
            </cataloginventory_stock_item_save_after>
            <catalogrule_rule_save_after>
                <observers>
                    <brim_pagecache>
                        <type>singleton</type>
                        <class>brim_pagecache/observer</class>
                        <method>cleanProductsInCatalogPriceRule</method>
                    </brim_pagecache>
                </observers>
            </catalogrule_rule_save_after>
		</events>
	</global>
    <frontend>
        <layout>
            <updates>
                <brim_pagecache>
                    <file>brim-page-cache.xml</file>
                </brim_pagecache>
            </updates>
        </layout>
        <events>
            <!-- Look at using this event instead: controller_front_init_before  -->
            <controller_action_predispatch>
                <observers>
                    <brim_pagecache>
                        <type>singleton</type>
                        <class>brim_pagecache/observer</class>
                        <method>checkAndServeCachedPage</method>
                    </brim_pagecache>
                </observers>
            </controller_action_predispatch>
            <controller_front_send_response_before>
                <observers>
                    <brim_pagecache>
                        <type>singleton</type>
                        <class>brim_pagecache/observer</class>
                        <method>cachePage</method>
                    </brim_pagecache>
                </observers>
            </controller_front_send_response_before>
            <!--  controller_front_send_response_after event is for for 1.4 compat -->
            <controller_front_send_response_after>
                <observers>
                    <brim_pagecache>
                        <type>singleton</type>
                        <class>brim_pagecache/observer</class>
                        <method>cachePage</method>
                    </brim_pagecache>
                </observers>
            </controller_front_send_response_after>
            <core_block_abstract_to_html_before>
                <observers>
                    <brim_pagecache>
                        <type>singleton</type>
                        <class>brim_pagecache/observer</class>
                        <method>prepareDynamicBlocks</method>
                    </brim_pagecache>
                </observers>
            </core_block_abstract_to_html_before>
            <core_block_abstract_to_html_after>
                <observers>
                    <brim_pagecache>
                        <type>singleton</type>
                        <class>brim_pagecache/observer</class>
                        <method>markDynamicBlocks</method>
                    </brim_pagecache>
                    <brim_pagecache_registertags>
                        <type>singleton</type>
                        <class>brim_pagecache/observer</class>
                        <method>registerTags</method>
                    </brim_pagecache_registertags>
                </observers>
            </core_block_abstract_to_html_after>
            <catalog_block_product_list_collection>
                <observers>
                    <brim_pagecache>
                        <type>singleton</type>
                        <class>brim_pagecache/observer</class>
                        <method>registerProductTags</method>
                    </brim_pagecache>
                </observers>
            </catalog_block_product_list_collection>
        </events>
        <brim_pagecache>
            <actions>
                <catalog_product_view>
                    <recently_viewed>
                        <class>Brim_PageCache_Model_Container_Recentlyviewed</class>
                        <method>addProductViewed</method>
                    </recently_viewed>
                </catalog_product_view>
            </actions>
        </brim_pagecache>
    </frontend>
    <default>
        <brim_pagecache>
            <settings>
                <enabled>1</enabled>
                <enable_block_updates>1</enable_block_updates>
                <cache_block_updates>0</cache_block_updates>
                <enable_minify_html>0</enable_minify_html>
                <expires>7200</expires>
                <invalidate_clean>0</invalidate_clean>
                <debug>0</debug>
                <debug_response>0</debug_response>
            </settings>
        </brim_pagecache>
    </default>
</config>
